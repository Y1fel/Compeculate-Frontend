<!--index.wxml-->
<view class="container">
  <!-- é¡¶éƒ¨æ ‡é¢˜ -->
  <view class="header-section">
    <text class="main-title">ç­”é¢˜æ’è¡Œæ¦œ</text>
    <text class="sub-title">å‰100åç©å®¶</text>
  </view>

  <!-- æ’è¡Œæ¦œåˆ—è¡¨ -->
  <view class="ranking-section">
    <!-- åŠ è½½çŠ¶æ€ -->
    <view wx:if="{{loading && rankingList.length === 0}}" class="loading-container">
      <view class="loading-spinner"></view>
      <text class="loading-text">åŠ è½½ä¸­...</text>
    </view>

    <!-- é”™è¯¯çŠ¶æ€ -->
    <view wx:elif="{{error && rankingList.length === 0}}" class="error-container">
      <text class="error-icon">âš ï¸</text>
      <text class="error-text">{{error}}</text>
      <button class="retry-btn" bindtap="retryLoad">é‡è¯•</button>
    </view>

    <!-- æ’è¡Œæ¦œå†…å®¹ -->
    <view wx:else>
      <!-- å‰ä¸‰åç‰¹æ®Šå±•ç¤º -->
      <view class="top-three">
        <!-- ç¬¬äºŒå -->
        <view class="rank-item second" wx:if="{{rankingList[1]}}">
          <view class="rank-number">2</view>
          <image class="rank-avatar" src="{{rankingList[1].avatarUrl}}" mode="cover"></image>
          <view class="rank-info">
            <text class="rank-name">{{rankingList[1].nickName}}</text>
            <text class="rank-score">{{rankingList[1].totalScore}}åˆ†</text>
          </view>
        </view>
        
        <!-- ç¬¬ä¸€å -->
        <view class="rank-item first" wx:if="{{rankingList[0]}}">
          <view class="rank-number">1</view>
          <image class="rank-avatar" src="{{rankingList[0].avatarUrl}}" mode="cover"></image>
          <view class="rank-info">
            <text class="rank-name">{{rankingList[0].nickName}}</text>
            <text class="rank-score">{{rankingList[0].totalScore}}åˆ†</text>
          </view>
          <view class="crown">ğŸ‘‘</view>
        </view>
        
        <!-- ç¬¬ä¸‰å -->
        <view class="rank-item third" wx:if="{{rankingList[2]}}">
          <view class="rank-number">3</view>
          <image class="rank-avatar" src="{{rankingList[2].avatarUrl}}" mode="cover"></image>
          <view class="rank-info">
            <text class="rank-name">{{rankingList[2].nickName}}</text>
            <text class="rank-score">{{rankingList[2].score}}åˆ†</text>
          </view>
        </view>
      </view>

      <!-- å…¶ä»–æ’ååˆ—è¡¨ -->
      <view class="ranking-list">
        <view class="rank-item normal" wx:for="{{rankingList}}" wx:key="id" wx:if="{{index >= 3}}" style="flex-direction: row;">
              <view class="rank-number">{{index + 1}}</view>
              <view class="rank-info-simple">
                  <text class="rank-name">{{item.nickName}}</text>
              </view>
              <view class="rank-score">{{item.score}}åˆ†</view>
        </view>
      </view>

      <!-- åŠ è½½æ›´å¤š -->
      <view class="load-more" wx:if="{{hasMore}}">
        <button class="load-more-btn" bindtap="loadMoreRanking" loading="{{isLoadingMore}}">
          <text class="load-more-text">{{isLoadingMore ? 'åŠ è½½ä¸­...' : 'åŠ è½½æ›´å¤š'}}</text>
        </button>
      </view>

      <!-- æ²¡æœ‰æ›´å¤šæ•°æ® -->
      <view wx:elif="{{!hasMore && rankingList.length > 0}}" class="no-more">
        <text class="no-more-text">æ²¡æœ‰æ›´å¤šæ•°æ®äº†</text>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨å¼€å§‹æ¯”èµ›æŒ‰é’® -->
  <view class="bottom-section">
    <button class="start-match-btn" bindtap="startMatch">
      <text class="btn-text">å¼€å§‹æ¯”èµ›</text>
    </button>
  </view>
</view>
